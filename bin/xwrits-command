#!/bin/zsh

# TODO: Should these be declared local variables?
NAME="xwrits-command"

CONF_PATH="/home/$(whoami)/.xwrits"
MICRO_PATH="$CONF_PATH/micro"
MACRO_PATH="$CONF_PATH/macro"

USAGE="usage: $NAME [-h] command
  commands:
    activate    Start xwrits - assumes it is not running
    reactivate  Restart xwrits
    deactivate  Stop xwrits
  flags:
    -h,--help   Display this message"

_run () {
# TODO: Loop to find multiple images for each level.
# TODO: Currently assumes these directories and files exist. Fix that.
# Micro
  xwrits typetime=5 breaktime=:30 title=Micro \
      warning-picture="$MICRO_PATH/warning.gif" \
      rest-picture="$MICRO_PATH/rest.gif" \
      ready-picture="$MICRO_PATH/ready.gif" \
      +multiscreen after=:30 +multiply=:5 \
      &

# Macro
  xwrits typetime=55 breaktime=5 title=Macro \
      warning-picture="$MACRO_PATH/warning.gif" \
      rest-picture="$MACRO_PATH/rest.gif" \
      ready-picture="$MACRO_PATH/ready.gif" \
      +multiscreen after=2 +multiply=1 \
      &
}

# TODO: Do this in a more extensible way.
if [[ $1 == "-h" || $1 == "--help" ]]; then
  print -u1 $USAGE

elif [[ $1 == "activate" ]]; then
  _run

elif [[ $1 == "reactivate" ]]; then
# TODO: Combine reactivate with start.
  killall xwrits
  _run

elif [[ $1 == "deactivate" ]]; then
  killall xwrits

else
  print -u2 "$0: Unknown command \"$1\"."
  print -u2 $USAGE
fi
